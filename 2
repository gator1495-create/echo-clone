# backend/app.py - ECHOCLONE CORE v2025
from fastapi import FastAPI, File, UploadFile, Form
from fastapi.responses import FileResponse
from TTS.api import TTS
import os
import uuid
import shutil

app = FastAPI(title="EchoClone API - Kill Shit Edition")

# Load YourTTS model (multilingual, instant clone)
tts = TTS("tts_models/multilingual/multi-dataset/your_tts", progress_bar=False, gpu=False)

os.makedirs("voices", exist_ok=True)
os.makedirs("output", exist_ok=True)

@app.post("/clone")
async def clone_voice(
    audio: UploadFile = File(...),
    text: str = Form("Yo homie, EchoClone just cloned me and we killing shit!")
):
    clone_id = str(uuid.uuid4())
    voice_path = f"voices/{clone_id}.wav"
    output_path = f"output/{clone_id}.wav"
    
    # Save uploaded voice
    with open(voice_path, "wb") as f:
        shutil.copyfileobj(audio.file, f)
    
    # Generate clone
    tts.tts_to_file(text=text, speaker_wav=voice_path, language="en", file_path=output_path)
    
    return FileResponse(output_path, media_type="audio/wav", filename="echo_clone.wav")
